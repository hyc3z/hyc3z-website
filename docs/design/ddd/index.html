<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Hyc3z&#39;s blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Hyc3z&#39;s blog Atom Feed"><title data-react-helmet="true">Domain Driven Design | Hyc3z&#x27;s blog</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://hyc3z.github.io/docs/design/ddd"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Domain Driven Design | Hyc3z&#x27;s blog"><meta data-react-helmet="true" name="description" content="DDD是为了解决什么问题？"><meta data-react-helmet="true" property="og:description" content="DDD是为了解决什么问题？"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://hyc3z.github.io/docs/design/ddd"><link data-react-helmet="true" rel="alternate" href="https://hyc3z.github.io/docs/design/ddd" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://hyc3z.github.io/docs/design/ddd" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.98273567.css">
<link rel="preload" href="/assets/js/runtime~main.05a31bdb.js" as="script">
<link rel="preload" href="/assets/js/main.95f6b553.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Hyc3z&#x27;s blog</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Notes</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/hyc3z" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Hyc3z<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">🌜</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">🌞</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/ai/artificial_intelligence_in_finance">ai</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/cpp/pcal">cpp</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/big-data/hadoop">big-data</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/blockchain/Chainlink">blockchain</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/cryptography/overview">cryptography</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/data/data_science">data</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/database/Oracle">database</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_VCh3" aria-current="page" href="/docs/design/ddd">design</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/design/ddd">Domain Driven Design</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/microservices">Microservices Patterns</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/software_architecture_fundamentals">Software Architecture</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/finance/principles_of_economics">finance</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link hasHref_VCh3" href="/docs/git/">git</a><button aria-label="Toggle the collapsible sidebar category &#x27;git&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/graph/graph-database">graph</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/music/Theory">music</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/ts_js/eventloop">ts_js</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/python/re">python</a></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Domain Driven Design</h1></header><h4 class="anchor anchorWithStickyNavbar_mojV" id="ddd是为了解决什么问题">DDD是为了解决什么问题？<a class="hash-link" href="#ddd是为了解决什么问题" title="Direct link to heading">​</a></h4><p>According to studies, approximately 70% of software projects are not delivered on time, on budget, or according to the client’s requirements</p><p>大约7成的软件最后都是失败的，有个专门的词形容这种情况，叫&quot;software crisis&quot;（软件危机）。这个词1968年就被提出了，中间人们提出了各种方式去尝试解决：</p><ul><li><p>Agile Manifesto（敏捷开发）</p><p><a href="https://agilemanifesto.org/principles.html" target="_blank" rel="noopener noreferrer">Principles behind the Agile Manifesto</a></p></li><li><p>Extreme programming（极限编程）</p><p><a href="http://www.extremeprogramming.org/" target="_blank" rel="noopener noreferrer">Extreme Programming: A Gentle Introduction.</a></p><p>相比传统的开发，更强调适应性，而不是可预测性。需求在不断变化，有能力在任何时候适应变化是更加现实有效的办法。</p></li><li><p>Test-driven develpment（测试驱动开发, TDD）</p><p>先写测试程序，然后再编码实现功能。测试不仅驱动着开发过程，还驱动代码的再设计和重构。</p></li><li><p>High-level languages</p><p>高级语言，相对一些较为底层的语言学习曲线更平滑，代码量更少。</p></li><li><p>DevOps</p><p>CI/CD，Microservices等等，包括和敏捷开发相关的一些日常流程</p></li></ul><p>然而，这些好像也都没能完全解决问题。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="business-domain">Business Domain<a class="hash-link" href="#business-domain" title="Direct link to heading">​</a></h4><p>所谓业务，就是一家公司主要的活动区域，大体上可以说是这家公司给客户提供的服务。比如：</p><ul><li>FedEx的邮递服务</li><li>星巴克的咖啡</li><li>沃尔玛的零售业务</li></ul><p>当然，一家公司也可以拥有多种不同的业务，比如亚马逊就同时有零售和云计算平台等业务。</p><p>重要的是，<strong>公司通常会经常变更业务</strong>。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="core-subdomain">Core Subdomain<a class="hash-link" href="#core-subdomain" title="Direct link to heading">​</a></h4><p>核心子业务，通常指一家公司和竞争对手差异化的部分，比如新的产品、服务，降本增效等。</p><p>Google的ranking algorithm则不然，它是一个单独的业务，不是子业务</p><p>核心的子业务通常都是复杂的。</p><p>这里还举了一个更好的例子，方便大家理解：</p><p>假设有一家公司是专门<strong>人工检测</strong>欺诈的，然后公司需要一个软件系统供分析师们工作。这个系统是核心子业务吗？</p><p>并不是。因为分析师们做的事，才是核心的，而软件系统无非是提交、批注、追踪等功能。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="generic-subdomains">Generic subdomains<a class="hash-link" href="#generic-subdomains" title="Direct link to heading">​</a></h4><p>通用的子业务，指所有公司都以相同/类似的方式完成对应的工作，然后市面上也有各种各样的可替代的方案，大家都用这些方案。</p><p>比如oa系统等</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="supporting-subdomains">Supporting subdomains<a class="hash-link" href="#supporting-subdomains" title="Direct link to heading">​</a></h4><p>支撑业务，用于支撑公司的业务，但不提供比较优势。比如ETL、CRUD的接口等</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="competitive-advantage">Competitive advantage<a class="hash-link" href="#competitive-advantage" title="Direct link to heading">​</a></h4><p>只有核心子业务才能带给公司足够的竞争优势。通用子业务并没有任何竞争的意义，而支撑子业务则门槛太低，没有技术壁垒。</p><p><strong>越是能解决困难的问题，一家公司的商业价值就越大。</strong></p><p>从技术的角度来说，我们需要分辨出哪些复杂的情况会影响到软件的设计。</p><p><img alt="image-20221216224231170" src="/assets/images/image-20221216224231170-0b5d3e48161168f7099e482f9f890733.png" width="1228" height="856"></p><h4 class="anchor anchorWithStickyNavbar_mojV" id="volatility">Volatility<a class="hash-link" href="#volatility" title="Direct link to heading">​</a></h4><p>易失性</p><p>如果一个问题，只要尝试一次就解决了，那么它肯定没办法用来作为比较优势。很简单，其他人也能解决。</p><p>因此，一家公司需要不断地在核心子业务上进行研究、创新和迭代，开发新的feature，或者对现有的场景进行优化，来一直保持优势。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="solution-strategy">Solution strategy<a class="hash-link" href="#solution-strategy" title="Direct link to heading">​</a></h4><p>一般来说，核心子业务肯定不能外包，否则核心的东西一旦没人维护就难以满足公司的目标了。通常都是公司最有才能的大佬们负责最核心的部分。</p><p>这也对解决方案提出了一些要求，即解决方案必须是可维护的(maintainable)，易革新的(easy to evolve)。</p><table><thead><tr><th>Subdomain type</th><th>Competitive advantage</th><th>Complexity</th><th>Volatility</th><th>Implementation</th><th>Problem</th></tr></thead><tbody><tr><td>Core</td><td>Yes</td><td>High</td><td>High</td><td>In-house</td><td>Interesting</td></tr><tr><td>Generic</td><td>No</td><td>High</td><td>Low</td><td>Buy/adopt</td><td>Solved</td></tr><tr><td>Supporting</td><td>No</td><td>Low</td><td>Low</td><td>In-house/outsource</td><td>Obvious</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_mojV" id="identifying-subdomain-boundaries">Identifying Subdomain Boundaries<a class="hash-link" href="#identifying-subdomain-boundaries" title="Direct link to heading">​</a></h4><p>如何划分出子业务的边界，是一个问题。比如我们可以从公司的部门、机构来入手：</p><p>比如一家零售电商，包括仓储、客服、物流、品控等。然而，这些对业务的划分都是粗粒度的划分。如果单独拿出一个“客服”业务，我们很容易根据直觉，得出这是一个通用的业务，毕竟客服几乎全部都是外包。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="distilling-subdomains">Distilling subdomains<a class="hash-link" href="#distilling-subdomains" title="Direct link to heading">​</a></h4><p>然而，当我们细细地拆分这个看似无聊的客服业务，却发现实际不简单：</p><p>比如Help desk和电话系统，这些可能确实是通用的业务</p><p>岗位的轮换、排版，可能是基础支撑业务</p><p>Case Routing - 将客户的事件，和业务员匹配，可就没那么简单了。许多公司甚至会开发一些相当精妙的算法，比如将事件交给处理过相似案例的职员处理等等。这就需要对案例进行分析，然后再聚类，这些都不是简单的任务。既然这个精妙的Routing算法能够为客户提供更好的服务，带来比竞争对手更好的客服体验，那么这个算法就是公司的核心子业务。</p><p><img alt="image-20221216225454314" src="/assets/images/image-20221216225454314-03adc0a37c879ec474c9c95847b85e87.png" width="1234" height="518"></p><p>当然，继续往下也可以再拆分，但总有个限度。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="subdomains-as-coherent-use-cases">Subdomains as coherent use cases<a class="hash-link" href="#subdomains-as-coherent-use-cases" title="Direct link to heading">​</a></h4><p>从技术的角度来说，一个子业务一定代表了一些互相关联的，内聚的用例。这些用例可能都涉及到同样的角色，同样的业务实体，修改相似的数据。</p><p>比如信用卡的支付业务，就是这样的例子：</p><p><img alt="image-20221216230150335" src="/assets/images/image-20221216230150335-415d978321c46fd44cb564a77f5dc8db.png" width="1242" height="780"></p><p>而对于一些通用的业务，可能没有太多必要向下深究，比如</p><p><img alt="image-20221216230355696" src="/assets/images/image-20221216230355696-846e695912677f385e57ccc810f2f276.png" width="1226" height="356"></p><p>Helpdesk的几个子业务都是通用的业务，那么深究带来的收益就不大。</p><p><em>It’s developers’ (mis)understanding, not domain experts’ knowledge, that gets released in production.</em></p><p>-- Alberto Brandolini</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="communication">Communication<a class="hash-link" href="#communication" title="Direct link to heading">​</a></h4><p><img alt="image-20221217130510534" src="/assets/images/image-20221217130510534-251958955520f04ce225b4b7eb57c8d1.png" width="1206" height="562"></p><p>通常在传统的开发模式中，往往业务的需求会翻译成程序猿能理解的需求，而这种翻译本身就会造成信息的损失。</p><p><img alt="image-20221217130941311" src="/assets/images/image-20221217130941311-cf924da7562adb3cdb2385948c51f41d.png" width="1260" height="454"></p><h4 class="anchor anchorWithStickyNavbar_mojV" id="ubiquitous-language">Ubiquitous Language<a class="hash-link" href="#ubiquitous-language" title="Direct link to heading">​</a></h4><p>正是由于翻译、转换，包括理解也会出现偏差，我们需要一种统一的语言来进行交流。</p><p>这种语言必须是精确的，始终如一的，避免歧义的。	</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="what-is-a-model">What Is a Model?<a class="hash-link" href="#what-is-a-model" title="Direct link to heading">​</a></h4><p><em>A model is a simplified representation of a thing or phenomenon that intentionally emphasizes certain aspects while ignoring others. Abstraction with a specific use in mind.</em></p><p>Rebecca Wirfs-Brock</p><p>一个有用的模型，并不是事无巨细地去模拟现实世界，而是用来有效地解决问题的。比如一张世界地图上，就不需要出现地铁站。</p><p><em>All models are wrong, but some are useful.</em></p><p>-- George Box</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="tools">Tools<a class="hash-link" href="#tools" title="Direct link to heading">​</a></h5><p>Glossary：术语表</p><p>术语表是最好的帮助消除歧义的工具，而且能够帮助解释一些晦涩的概念。</p><p>Gherkin (cucumber)</p><p><a href="https://github.com/cucumber/cucumber-js" target="_blank" rel="noopener noreferrer">cucumber/cucumber-js: Cucumber for JavaScript (github.com)</a></p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Feature: Greeting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Scenario: Say hello</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    When the greeter says hello</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Then I should have heard &quot;hello&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>尽管这种Behavior-driven的测试看上去极其繁琐，但是对复杂的业务场景是有帮助的。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="jack-of-all-trades-master-of-none">&quot;jack of all trades, master of none.&quot;<a class="hash-link" href="#jack-of-all-trades-master-of-none" title="Direct link to heading">​</a></h4><p><img alt="image-20221217132820887" src="/assets/images/image-20221217132820887-8fc7efbf1eeb28efee286fb8c91710d3.png" width="1204" height="694"></p><p>像图中这样的模型，就是典型的杂而不精，最终啥也做不好。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="bounded-context">Bounded Context<a class="hash-link" href="#bounded-context" title="Direct link to heading">​</a></h4><p><img alt="image-20221217133210174" src="/assets/images/image-20221217133210174-e0298be4b8187871091a9aec7fd5899e.png" width="1202" height="574"></p><p><img alt="image-20221217133420918" src="/assets/images/image-20221217133420918-d0ec775117bc874ee6a3caa510f0816a.png" width="1212" height="606"></p><p>模型的最终目的是有效，因此模型的规模并不是教条的，必须大还是小。当然，模型的规模确实会对业务的统一有一些影响，比如模型越大，就越容易出现概念的冲突，一致性就越困难。模型越小，集成的代价就越大，维护的成本也就越高。这是一个权衡的过程。</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="bounded-contexts-vs-subdomains">Bounded Contexts vs Subdomains<a class="hash-link" href="#bounded-contexts-vs-subdomains" title="Direct link to heading">​</a></h5><p>业务的场景则是相对被动地由公司和系统的要求决定的。作为工程师，肯定在公司中并不是拍板人，决定不了要做什么，而是分析当前的业务，识别子领域。</p><p>相对来说，Bounded Context就是人为定义的，是一种设计的抉择。如果愿意，甚至可以定义一个横跨公司所有业务的模型（Monolithic），对小系统也是有效的。</p><p>当相互冲突的模型出现，那么就需要将系统继续分解为小的Context。</p><p>一句话：</p><p>subdomains are discovered and bounded contexts are designed.</p><p><em>Architectural design is system design. System design is contextual design—it is inherently about boundaries (what’s in, what’s out, what spans, what moves between), and about trade-offs. It reshapes what is outside, just as it shapes what is inside.</em></p><p>-- Ruth Malan</p><p>重要的是，一个Bounded context只应该由一个Team维护。当然，一个Team可以拥有多个Bounded context</p><p><em>A model should omit the extraneous information irrelevant to the task at hand.</em></p><h4 class="anchor anchorWithStickyNavbar_mojV" id="partnership">Partnership<a class="hash-link" href="#partnership" title="Direct link to heading">​</a></h4><p>不同的Context也需要由交互和合作。</p><p><img alt="image-20221217135514330" src="/assets/images/image-20221217135514330-1b95f8c77f0451050b71d8fd449c66cd.png" width="1240" height="358"></p><p>在Partnership model - 伙伴模型中，一个Team提醒另一个Team 自己的API发生了改动，然后第二个Team就会进行合作和适配。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="shared-kernel">Shared Kernel<a class="hash-link" href="#shared-kernel" title="Direct link to heading">​</a></h4><p><img alt="image-20221217135835312" src="/assets/images/image-20221217135835312-c3ee19acc63741d82b2060dc27a8e2f9.png" width="1238" height="688"></p><p>多个Bounding context分享一个共同的模型，这个模型有点类似于交集，只定义一些需要被大家共同定义的内容。一旦这个核心模型被修改，那么引用它的Bounding context也都要做相应的修改或适配。</p><p>当然，这个模型违背了一个Bounding Context被一个Team开发的原则，所以是一个例外，需要格外小心地使用。</p><p>当然，如果这几个Context都是同一个Team开发的，情况会相对好一些。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="customersupplier">Customer–Supplier<a class="hash-link" href="#customersupplier" title="Direct link to heading">​</a></h4><p><img alt="image-20221217140337744" src="/assets/images/image-20221217140337744-9cecd1a1be228d98aa048a15f7da6a01.png" width="1218" height="496"></p><p>上游的Service就是Provider，而下游的Service就是Customer。</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="conformist">Conformist<a class="hash-link" href="#conformist" title="Direct link to heading">​</a></h5><p>下游的服务遵循上游的定义 -- Take it or leave it</p><p>上游的服务对定义占据主导权</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="anticorruption-layer">Anticorruption Layer<a class="hash-link" href="#anticorruption-layer" title="Direct link to heading">​</a></h5><p><img alt="image-20221217140638642" src="/assets/images/image-20221217140638642-ffafa8f2d04eaced9e1615078b02c9c2.png" width="1208" height="482"></p><p>下游的Service可以增加一个Anticorruption Layer，相当于对上游的模型进行了一次转译，得到适合自己Context的模型</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="open-host-service">Open-Host Service<a class="hash-link" href="#open-host-service" title="Direct link to heading">​</a></h4><p><img alt="image-20221217140829850" src="/assets/images/image-20221217140829850-e4191817b95c26c2df2bf255aacca7b8.png" width="1220" height="504"></p><p><img alt="image-20221217140923037" src="/assets/images/image-20221217140923037-013fa75eb3fc2eee07be7a60e254a5af.png" width="1222" height="748"></p><p>在这种模式下，Consumer占据主导权，让Supplier能够根据需要以不同的进度对公开模型进行更改，如上图2.</p><p>下图是整体的Context Map</p><p><img alt="image-20221217141119424" src="/assets/images/image-20221217141119424-d664dddb4959cbdb53a7b4a9ca004219.png" width="1226" height="694"></p><h4 class="anchor anchorWithStickyNavbar_mojV" id="transactional-behavior">Transactional Behavior<a class="hash-link" href="#transactional-behavior" title="Direct link to heading">​</a></h4><p>所有的操作，都应该要么成功，要么失败，而不是停留在一个非法的状态下。</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="transaction-script">Transaction Script<a class="hash-link" href="#transaction-script" title="Direct link to heading">​</a></h5><p>将系统的操作整理为简单、直接的过程脚本，每个步骤都是事务性的。类似ETL的操作</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="active-record">Active Record<a class="hash-link" href="#active-record" title="Direct link to heading">​</a></h5><p>Acrive record就是一种能提供简单CRUD方法的数据结构</p><p>当然，以上这两种都是针对简单的业务，对复杂的业务可能并不太适用。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="domain-model">Domain Model<a class="hash-link" href="#domain-model" title="Direct link to heading">​</a></h4><h5 class="anchor anchorWithStickyNavbar_mojV" id="value-object">Value object<a class="hash-link" href="#value-object" title="Direct link to heading">​</a></h5><p>如颜色类：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">class Color</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int _red;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int _green;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int _blue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>很显然，在这样的类里，定义一个额外的Color-id是完全没必要的，反而会埋下潜在的bug，比如比较color-id，却无法得到两个color是相同的还是不同的。</p><p><img alt="image-20221217142926250" src="/assets/images/image-20221217142926250-d21ede81644af653551268a7ee0fc42f.png" width="1260" height="574"></p><h5 class="anchor anchorWithStickyNavbar_mojV" id="ubiquitous-language-1">Ubiquitous language<a class="hash-link" href="#ubiquitous-language-1" title="Direct link to heading">​</a></h5><p>primitive obsession</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">class Person</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private int    _id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private string _firstName;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private string _lastName;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private string _landlinePhone;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private string _mobilePhone;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private string _email;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private int    _heightMetric;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private string _countryCode;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Person(...) {...}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>vs</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">class Person {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private PersonId     _id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Name         _name;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private PhoneNumber  _landline;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private PhoneNumber  _mobile;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private EmailAddress _email;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Height       _height;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private CountryCode  _country;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Person(...) { ... }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>value objects使得验证更加严格，判断逻辑更加有鲁棒性，而且也不需要再记忆一大堆的传统了。</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="aggregates">Aggregates<a class="hash-link" href="#aggregates" title="Direct link to heading">​</a></h5><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">public void AddMessage(UserId from, string body)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var message = new Message(from, body);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _messages.Append(message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>vs</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">public void Execute(AddMessage cmd)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var message = new Message(cmd.from, cmd.body);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _messages.Append(message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>我们可以把判断逻辑移到Aggregate中，这样应用层就只需要拿到Aggergate的值，然后执行所需要的任务就可以了。</p><p>所有能够接受最终一致性的数据都应该在Aggregate外部，而Aggregate的内部是强一致性的。</p><p><img alt="image-20221217144443210" src="/assets/images/image-20221217144443210-3da62ae9c67df8972c181da3aca6f7a6.png" width="1234" height="726"></p><p>因此，Aggregate应该尽可能地小，只包括必须要强一致的实体。</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="domain-event">Domain Event<a class="hash-link" href="#domain-event" title="Direct link to heading">​</a></h5><p><img alt="image-20221217144957753" src="/assets/images/image-20221217144957753-682ffd2eea4d6fdf3708d2fd52b506d2.png" width="1252" height="452"></p><h5 class="anchor anchorWithStickyNavbar_mojV" id="domain-services">Domain services<a class="hash-link" href="#domain-services" title="Direct link to heading">​</a></h5><p>无状态的对象，负责不属于任何Value Objects或Aggregates的业务逻辑</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="event-sourcing">Event Sourcing<a class="hash-link" href="#event-sourcing" title="Direct link to heading">​</a></h4><p><em>Show me your flowchart and conceal your tables,</em> <em>and I shall continue to be mystified. Show me your tables, and I won’t usually need your flowchart; it’ll be obvious.</em></p><p>-- Fred Brooks</p><p>如果在一张表中只记录了数据的现状，那么我们并不知道数据具体发生了哪些变化。</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="source-of-truth">Source of Truth<a class="hash-link" href="#source-of-truth" title="Direct link to heading">​</a></h5><p><img alt="image-20221217150420463" src="/assets/images/image-20221217150420463-6ef5b4a0cddea479e6d82dc08be27f83.png" width="1274" height="386"></p><p>乐观的异步，最起码要对事件的版本号进行判断，如果已经有大于版本号的事件就抛异常。</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="advantages">Advantages<a class="hash-link" href="#advantages" title="Direct link to heading">​</a></h5><p>Event sourcing 的优势是显而易见的：能够使得系统的状态重建、恢复、回滚变的可能，并且提供了更多可供分析的数据，也提供了一种管理并行的方式。</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="disadvantages">Disadvantages<a class="hash-link" href="#disadvantages" title="Direct link to heading">​</a></h5><p>缺点就是模型的学习曲线较为陡峭，更新迭代富有挑战，也增加了复杂度。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/design/ddd.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/database/mongodb"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">MongoDB</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/design/microservices"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Microservices Patterns</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.05a31bdb.js"></script>
<script src="/assets/js/main.95f6b553.js"></script>
</body>
</html>